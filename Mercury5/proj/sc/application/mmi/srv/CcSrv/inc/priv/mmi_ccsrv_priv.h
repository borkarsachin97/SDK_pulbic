/**
* @file mmi_ccsrv_priv.h
*
* State Machine Service - CCSRV
* Generated by XFSM v1.0, CodeVer=v0.24
*
* Class Id: CLSID_CCSRV
*
*
* @version $Id: mmi_ccsrv_priv.h 38890 2009-08-29 16:22:38Z zinc.chen $
*/
#ifndef __MMI_CCSRV_PRIV_H__
#define __MMI_CCSRV_PRIV_H__

/*=============================================================*/
// Include files
/*=============================================================*/

#include "mmi_mae_common_def.h"
#include "mmi_mae_sm_defs.h"
#include "mmi_ccsrv.h"
#include "mmi_ccsrv_sm.h"
#include "mmi_mae_datamodel.h"
#include "mmi_mae_notifier.h"
#include "mmi_cfgsrv.h"
#include "mmi_simsrv.h"
#include "mmi_ccsrv_ctmgr.h"
#include "mmi_btsrv.h"
#include "mmi_common_util.h"
#include "mmi_mae_clock.h"
#include "mmi_voicecallsrv.h"
#include "mmi_common_cfg.h"
#include "mmi_mae_clock_types.h"
#include "mmi_vendorsrv.h"


/*=============================================================*/
// Macro definition
/*=============================================================*/

/*=============================================================*/
// Data type definition
/*=============================================================*/

/**
 * Application structure
 */
typedef struct MMI_CCSRV_TAG
{
    DECLARE_FUNCTBL(ICCSRV);  // function table pointer
    u32 refCnt;     // reference count
    SM_Mao_t app;       // StateMachine Application data
    SM_ModeId_t _lastActiveMode[cCCSRV_ModeNumbers];    // Last child, current active child
    SM_ModeId_t _currentMode[1];
    /* Add custom fields below */
    //IApplet* pCCApp;

    MAE_Notifier_t *pNotifier;                   //Notify the APP/Service who are interested to CC event
    IDataModel *pCallTableDModel; //DataModel is used to manage Call Table
    CallTable_t *pCallTableCache;   //Hold the call table pointer (This pointer won't be change in CC Service life cycle)
    ICFGSrv *pCfgSrv;                   // Hold the instance of Setting
    ISIMSRV *pSimSrv;                   // Hold the instance of SIM
#ifdef __BLUETOOTH_MMI__
    IBTSRV *pBTSrv;                     // to notify BT status of cc
#endif
	IVENDORSRV *pVendorSrv;			//for filter incoming call and kill vendor
    IClock *pIClock;                // Hold the instance of IClock
    ClockListener_t ClockModelListener;     // IClock model listener
    boolean bCountMinTick;          // flag for count minute tick

    boolean bTerminate;
    boolean bMisscallExisted;
    CCSRV_CLCC_Type_e		u8CLCCType;     // keep CLCC query cause.
    u32                     u32Cause;       // keep call cause

    CallTableEntry_t *pEntry;           //Temp storage to keep information before write to call table
    COMMON_TotalEccList_t *pECCTbl;     // SIM ECC and Customized Emergency call table

    u8 u8DualID;
    u8 u8MakeCallID;        //Store call id for outgoing call
    u8 u8IncomingCallID;        //Store call id for incoming call or waiting call
    u8 u8ChldOperCallID;        //Store call id for chld operation (Ex. Release specific call by Public MMI)
    u8 u8CheckBlackListRetFlag; //A flag to distinguish the return mode for CheckBlacklist mode (1A/ 1H/ 1A1H)
    u32 u32SessionStartTime;
    u32 u32InCallDuration;
    u32 u32HangupTimeTick;
    u32 u32MinuteTick;
    boolean bHangUp;
    MMI_Call_Chld_Type_e u8ChldOperFlag;
    boolean bWaitAcceptCnfFrom1A1H1Waiting;  /*The case is:
                                               User chose to "Replace hold call", so the hold call is release first at 1A1H/waiting mode, and accept the waiting call.
                                               Before the Accept confirm is back, state machine will stay in 1A/waiting mode. CC_SRV will Post different event to CC_APP by this flag*/
    u8 u8RelHeldCallCount;  // To avoid infinite loop
    boolean bAutoRedial;        // Keep the Auto redial status for CCAPP.
    boolean bPreMOCall;     // Keep the PreMO call status(Check dual mode or IP call)

    MmiMakeCallReq_t *pMake2ndCall; // Cache data for Make2ndCall from 1A ( CCSRV will hold Active call first, then MO call)
    boolean bAccepted;
    boolean bWaitHangupCnf;
    boolean bHangupCallLater;       // Handle user accept call and hangup call at the same time.

	boolean bRejectMTCall;

    boolean bMakingCall; //Flag to keep making first call state to avoid mode transition issue.

	boolean bDistortedVoice; // distorted voice on/off
	MMI_CALLSETTING_DISTORTED_EFFECT_e eDistortedEffect; // distorted voice effect

#ifdef __APP_MMI_ANSWERING_MACHINE__
	boolean bAnsweringMachineInProgress; // to indicate if there is an active call in Answering Machine mode
#endif
#ifdef __APP_MMI_CALL_BACKGROUND_SOUND__
	// call background sound variables
	boolean bCBSStatus;
	CallBgSound_Play_Type_e eCBSPlayType;
	u8 u8CBSPlayInterval;
	u8 u8CBSCurEffect;
    u8 u8CBSVolume;
#endif //__APP_MMI_CALL_BACKGROUND_SOUND__
} MMI_CCSRV;

/*=============================================================*/
// Local function prototype declaration and definition
/*=============================================================*/

MAE_Ret mmi_CCSRV_Notify(MMI_CCSRV *pThis, u32 nMask, MAEEvent_t nEvt, u32 nLParam, u32 nDParam);

#endif /* __MMI_CCSRV_PRIV_H__ */
