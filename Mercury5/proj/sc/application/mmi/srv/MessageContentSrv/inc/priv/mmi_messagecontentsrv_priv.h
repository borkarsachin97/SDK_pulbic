/**
* @file mmi_messagecontentsrv_priv.h
*
* Service without using State Machine - MCI
* Generated by XFSM v1.0, CodeVer=v0.24
*
* Class Id: CLSID_MCI
* Interface Id: IID_MCI
*
* @version $Id: mmi_mci_priv.h 37849 2009-08-14 09:35:19Z ray.lee $
*/
#ifndef __MMI_MESSAGECONTENTSRV_PRIV_H__
#define __MMI_MESSAGECONTENTSRV_PRIV_H__

#include "mmi_mae_common_def.h"
#include "mmi_messagecontentsrv.h"
#include "mmi_mae_filemgr.h"



typedef struct  UDH_IEI_ITEM_TAG
{
    boolean bConcated;
#ifdef __SMS_3GPP_R8_SUPPORT__   
    mmiGsmLockShiftTable_e eLockTable;
    mmiGsmSingleShiftTable_e eSingleTable;
#endif
#ifdef __SMART_MESSAGING_MMI_SUPPORT__
	u8	pWapPort[2];
#endif
    u8 nRef;
    u8 nPacketNum;
    u8 nCurSeqNum;

}UDH_IEI_ITEM_t;

#define pattern_URL_protocol L"http://"
#define pattern_sURL_protocol L"https://"
#define pattern_URL_host L"www."
#define pattern_WAP_host L"wap."
#define pattern_RTSP_protocol L"rtsp://"
#define token_URL_protocol_Upper 0x48   // 'H';
#define token_URL_protocol_Lower 0x68   // 'h';
#define token_URL_host_Upper 0x57       //'W';
#define token_URL_host_Lower 0x77       //'w';
#define token_RTSP_protocol_Upper 0x52   // 'R';
#define token_RTSP_protocol_Lower 0x72   // 'r';
#define token_email 0x40
#define token_space 0x20
#define token_semicolon 0x3b            //;
#define token_comma 0x2c                //,
#define token_colon 0x3a               //:
#define token_exclamation 0x21     //!
#define token_dollarsign 0x24         //$
#define token_and 0x26            //&
#define token_percentage 0x25         //%
#define token_starsign 0x2a             //*
#define token_equalsign 0x3d           //=
#define token_slash 0x2f                 //'/'
#define token_antislash 0x5c          //'\'
#define token_wellsign 0x23       //#
#define token_plus 0x2b                   //+
#define token_minus 0x2d                //-

/* Max. length of SMS-SUBMIT headers: TP-FO(1) + TP-MR(1) + TP-DA(12) + TP-PID(1) + TP-DCS(1) + TP-VP(7) + TP-UDL(1) */
#define MCI_MAX_LEN_SMSSUBMI_HEADER     24
/* Max. length of SMS-DELIVER headers: TP-FO(1) + TP-OA(12) + TP-PID(1) + TP-DCS(1) + TP-SCTS(7) + TP-UDL(1) */
#define MCI_MAX_LEN_SMSDELIVER_HEADER   23

/**
 * Application structure
 */
typedef struct MMI_MCI_TAG
{
    DECLARE_FUNCTBL(IMCI);    // function table pointer
    u32 refCnt;     // reference count
    /* Add custom fields below */
    u8 bTerminateState;
} MMI_MCI;

typedef struct {
	SMI_SmEncoding_t	     encoding;
#ifdef __SMS_3GPP_R8_SUPPORT__    
    mmiGsmLockShiftTable_e   eLockTable;
    mmiGsmSingleShiftTable_e eSingleTable;
#endif
	u8					vp[SMI_MAX_VP_LEN];
	u8					scts[7];
	u8					pid;							// Future proofing - holds a PID for telematic interworking etc
	u8					iHeaderByte1;					// Header byte 1 - see GSM 3GPP TS 23.040
	u8					bUdhi;
} MCI_EncodeOption_t;

void MCI_FreeObjectListItem(void *pData, IBase *pOwner);
static void MCI_wstrncpy(MAE_WChar **pDest, const MAE_WChar *pSource, u32 len);
static MAE_Ret MCI_AddSpcObj(MMI_MCI *pThis, MAE_WChar *str, u32 nStart, u32 nEnd, MCI_SMCntObjType_e type, IVectorModel *pIObjList);
static MAE_Ret MCI_ParseContent(MMI_MCI *pThis, MAE_WChar *pMsgCnt, IVectorModel **ppObjCnt, IBase *pRequester);

/*
* MCI_EncodeSmsTpduHeader
* @brief    To encode the TPDU headers:
*           SMS-SUBMIT TPDU: TP-FO,TP-MR,TP-DA,TP-PID,TP-DCS,TP-VP,TP-UDL
*           SMS-DELIVER TPDU: TP-FO,TP-OA,TP-PID,TP-DCS,TP-SCTS,TP-UDL
*/
static MAE_Ret MCI_EncodeSmsTpduHeader(MMI_MCI *pThis, u8 msgType, MCI_EncodeOption_t *pEncodeOption, u8 *plAddress, SMI_TimeStamp_t* pTimeStamp, u8 **ppTpduHdr, u8 *pTpduHdrLen);



static MAE_Ret mmi_MCI_GetSCTSByTimeStamp(MMI_MCI * pThis, SMI_TimeStamp_t* pTimeStamp, u8* pSCTS);
void mmi_MCI_UpdateConSMSIEISeqNum(u8 *pudh, u8 nSeqNum);
void mmi_MCI_UpdateConSMSIEIMaxNum(u8 *pudh, u8 nMaxNum);
#ifdef __MMI_SMS_WAPPUSH__
static MAE_Ret MCI_ParseWapPushCnt(u8 *pu8MsgHead, u32 slen, MAE_WChar **pMsgUrl, MAE_WChar **pMsgDescription);
#endif

#endif /* __MMI_MESSAGECONTENTSRV_PRIV_H__ */
